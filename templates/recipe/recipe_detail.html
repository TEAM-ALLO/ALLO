{% extends 'base.html' %}
{% block head %}
    <link rel="stylesheet" href="/static/css/recipe/recipe_detail.css">
{% endblock %}
{% block content %}

<div class="recipe-detail-info">
    {% if recipe.image %}
    <img src="{{ recipe.image.url }}" alt="{{ recipe.recipe_name }}" class="recipe-detail-img">
    {% else %}
    <img src="/static/img/empty2.svg" alt="" class="recipe-detail-img">
    {% endif %}
    <div class="recipe-detail-menu">
        <div class="recipe-title-container">
            <h1>{{ recipe.recipe_name }}</h1>
            {% if user == recipe.author %}
            <div class="recipe-detail-btns">
                <a href="{% url 'recipe_user:recipe_edit' id=recipe.id %}">수정</a>
                <a href="{% url 'recipe_user:recipe_delete' id=recipe.id %}" onclick="return confirm('정말로 삭제하시겠습니까?');">삭제</a>
            </div>
            {% endif %}
            <div class="actions">  
                <a href="{% url 'recipe_user:like_recipe' recipe.id %}" class="btn btn-primary">Like ({{ recipe.total_likes }})</a>
                <a href="{% url 'recipe_user:bookmark_recipe' recipe.id %}" class="btn btn-info">
                {% if request.user in recipe.bookmarks.all %}
                    Bookmark
                {% else %}
                    Bookmarked
                {% endif %}
                </a>
            </div>
        </div>
        <p>작성자: {{ recipe.author }}</p>
        <!-- <div>
            <p>작성일: {{ recipe.created_at }}</p>
            <p>수정일: {{ recipe.updated_at }}</p>    
        </div> -->
        <p>{{ recipe.servings }}인분</p>
        <div class="recipe-detail-cook">
            <p>난이도: {{ recipe.difficulty }}</p>
            <p>조리 시간: {{ recipe.cooking_time }}분</p>
        </div>        
    </div>
</div>
<h2 class="recipe-detila-ingredient-title">재료</h2>
<div class="recipe-detail-ingredient">
    {% for ingredient in recipe.ingredients.splitlines %}
    <div>{{ ingredient }}</div>
    {% endfor %}
</div>
<div class="recipe-detail-step-container">
    <h2>레시피</h2>
    {% for index, instruction in instructions_with_index %}
    <div class="recipe-detail-steps">
        <div class="recipe-detail-step">{{ index }}단계</div>
        <div class="receipe-detail-content">{{ instruction }}</div>
    </div>
    {% endfor %}
</div>

<!-- 기존 레시피 상세 정보 아래에 추가 -->

<h3>댓글</h3>
<!--로그인 안됏을때 멘트 뜨도록 ㅇㅇ 섭밋 이런건 없어두댐-->
{% if request.user.is_authenticated %}
  <form action="{% url 'recipe_user:comments_create' recipe.id %}" method="POST">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <input type="submit">
  </form>
{% else %}
  <a href="{% url 'users_user:login' %}">[댓글을 작성하려면 로그인하세요.]</a>
{% endif %}


<h4>댓글 목록</h4>
<!--read-->
{% if comments %}
  <p><b>{{ comments|length }}개의 댓글이 있습니다.</b></p>
{% endif %}
<ul>
  {% for comment in comments %}
    <li>
      {{ comment.user }} - {{ comment.content }}
      <!--delete-->
      {% if user == comment.user %}
        <form action="{% url 'recipe_user:comments_delete' recipe.id comment.id %}" method="POST" class="d-inline">
          {% csrf_token %}
          <input type="submit" value="DELETE">
        </form>
      {% endif %}
    </li>
  {% empty %}
    <p>댓글이 없어요..</p>
  {% endfor %}
</ul>
<hr>


<div class="btn-div">
    <a href="{% url 'recipe_user:recipe_list' %}" class="recipe-detail-btn">목록</a>
</div>
{% endblock %}
